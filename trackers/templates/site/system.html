{% extends 'site/base.html' %}

{% block subtitle %}
System Info
{% endblock %}

{% block extraHead %}
<script type="text/javascript">
    $(document).ready(function()
    {
    {% if kspace %}
        $('#jumps').load("{{ url_for('.get_tradehub_jumps', system=systemObject.name) }}");
        $('#kills').load("{{ url_for('.system_kills', system=systemObject.name) }}");
        $('#system_api_info').load("{{ url_for('.system_api_info', system=systemObject.name) }}");
    {% endif %}
        $('#closest_system').load("{{ url_for('.closest_chain_system', system=systemObject.name) }}", function() {
            $("#toggle_additional").on("click", function()
            {
                console.log("toggle");
                $("#additional_entrances").fadeToggle(500);
            });
        });
    });
</script>
{% endblock %}

{% block content %}

<center>

<h1>{{ systemObject.name }}{% if rename %} "{{ rename }}"{% endif %}{% if class_ %}, Class {{ class_ }}
{% if systemObject.effect %} ({{ systemObject.effect }}){% endif %}{% endif %}{% if security %}, sec {{ security }}{% endif %}</h1>

{% if eveigb['solarsystemname'] == systemObject.name %}
    <h3>You are currently in this system</h3>
{% endif %}

{% if kspace %}
<span id="closest_system">
    <span class="text-left gray">Loading closest system ...</span>
</span>

<span id="system_api_info">
    <span class="text-left gray"><br /><br />Loading api data ...</span>
</span>
{% endif %}

<div class="row">
    {% if kspace %}
        <div class="col-lg-6">
            <p id="kills"><span class="text-left gray">Loading recent kills in this system ...</span></p>
        </div>
        <div class="col-lg-6">
            <div style="width: 100%; margin-bottom: 20px;" id="jumps"><span class="text-left gray">Loading jumps to major tradehubs ...</span></div>
        </div>
    {% else %}
    <div class="span12">
        <h4><b>Statics</b>:<br />{{ systemObject.static }}</h4>
    </div>
    {% endif %}
</div>

<h4>Alliance Notes</h4>
<form action="" method="POST" id="notesform">
    <textarea name="systemnote" id="systemnote" style="width: 45%;" rows="10">{{ systemObject.note }}</textarea><br />
    <input class="btn btn-primary" type="submit" value="Save">
</form>

<br />

<h3>Open wormholes</h3>
{% if openwormholes %}
    <table class="extracellspacing">
        <tr>
            <th>Scan id</th>
            <th>Date entered</th>
            <th>Last updated</th>
            <th>From</th>
            <th>Leads to</th>
        </tr>
        {% for w in openwormholes %}
            {% if w.opened %}
            <tr class="open">
            {% else %}
            <tr class="closed">
            {% endif %}
                <td><a href="{{ url_for('.wormhole', id=w.id) }}">{{ w.scanid }}</a></td>
                <td>{{ w.date|date }}</td>
                <td>{{ w.time }}</td>
                <td>
                    {% if systemObject.name == w.start %}
                       <i>{{ w.start }}</i>
                    {% else %}
                        <a href="{{ url_for('.system', system=w.start) }}">{{ w.start }}</a>
                    {% endif %}
                </td>
                <td>
                    {% if systemObject.name == w.end %}
                        <i>{{ w.end }}</i>
                    {% else %}
                        <a href="{{ url_for('.system', system=w.end) }}">{{ w.end }}</a>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
    </table>
{% else %}
    <p>None</p>
{% endif %}

<div class="row">
    <div class="col-lg-6">
        <h3>Currently open sites</h3>
        {% if opensites %}
            <table class="extracellspacing">
                <tr>
                    <th>Scan id</th>
                    <th>Date entered</th>
                    <th>Name</th>
                </tr>
                {% for s in opensites %}
                    {% if s.isAnom %}
                    <tr class="anom">
                    {% elif s.opened %}
                    <tr class="open">
                    {% else %}
                    <tr class="closed">
                    {% endif %}
                        <td><a href="{{ url_for('.site', id=s.id) }}">{{ s.scanid }}</a></td>
                        <td>{{ s.date|date }}</td>
                        <td>{{ s.name }}</td>
                    </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>None</p>
        {% endif %}
    </div>
    <div class="col-lg-6">
        <h3>Unopened sites</h3>
        {% if unopenedsites %}
            <table class="extracellspacing">
                <tr>
                    <th>Scan id</th>
                    <th>Date entered</th>
                    <th>Name</th>
                </tr>
                {% for s in unopenedsites %}
                    {% if s.isAnom %}
                    <tr class="anom">
                    {% elif s.opened %}
                    <tr class="open">
                    {% else %}
                    <tr class="closed">
                    {% endif %}
                        <td><a href="{{ url_for('.site', id=s.id) }}">{{ s.scanid }}</a></td>
                        <td>{{ s.date|date }}</td>
                        <td>{{ s.name }}</td>
                    </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>None</p>
        {% endif %}
    </div>
</div>

<h3>Closed wormholes</h3>
{% if closedwormholes %}
    <table class="extracellspacing">
        <tr>
        <th>Scan id</th>
        <th>Date entered</th>
    </tr>
    {% for w in closedwormholes %}
        <tr>
            <td><a href="{{ url_for('.wormhole', id=w.id) }}">{{ w.scanid }}</a></td>
            <td>{{ w.date|date }}</td>
        </tr>
    {% endfor %}
    </table>
{% else %}
    <p>None</p>
{% endif %}

</center>

{% endblock %}
